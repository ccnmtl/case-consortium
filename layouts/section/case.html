<html>
        {{ partial "header.html" . }} 

<body class="search">
	<div id="page-wrapper">

	<!-- Header --><div id="header-wrapper">
  <link rel="stylesheet" href="{{ .Site.BaseURL }}js/tablesorter/themes/blue/style.css" />
  <script type="text/javascript" src="/js/tablesorter/jquery.tablesorter.js"></script> 
	{{ partial "header_section.html" . }}
	<!-- End Header --></div>

<!-- Main Wrapper --><div id="main-wrapper" class="box container">
	<!-- Search Box --><div id="search">
							<form class="form-inline" role="search">
							<div class="input-group">
							<span class="ion-android-search"></span>
							<input id="q" type="text" placeholder="Search for Cases" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Search for Cases'" />
              				<button class="close-icon" id="clear-search" type="reset"></button>
							<div class="input-group-btn"></div>
							</div>
							</form>
							<div id="search-results"></div>
<!-- End Search Box --></div>
<!-- Browse Cases --><div class="row 200% browse_cases">





    <!-- End Search Results -->
<!-- Sidebar -->
	<div class="3u 12u$(medium)" id="sidebar">
	<!-- Facets -->
	<div id="facets"></div>
	<!-- End Facets -->
	</div>
<!-- End Sidebar -->
	<div class="9u 12u$(medium) important(medium)">
		<div id="content">
	<!-- Content -->

	<table class="alt tablesorter" id="results"></table>
	<!-- End Content -->
		</div>
	</div>



<!-- End Browse Cases -->
<!-- End Main Wrapper --></div>
</div>

         {{ partial "footer.html" . }}

          <script data-export="true" data-file-extension="js" id="facetize">
            jQuery(document).ready(function(){
                    $.getJSON('/js/api/cases.json').success(function(cases){
                            window.Cases = cases;
                        }).error(function(){
                            alert('There was a problem loading the cases.')
                        }).complete(function(){
                            function setTableHeaders(){
                                  jQuery('#results').prepend('<thead>' +
                                                        '<tr>' +
                                                            '<th class="case_id_head">Case Number</th>' +
                                                            '<th class="case_title_head">Title</th>' +
                                                            '<th class="case_topics_head">Category</th>' +
                                                        '</tr>' +
                                                      '</thead>');
                            }
                            window.unescapeHtml = function(){
                              jQuery('.unescape').each(function(){
                                  var text = jQuery(this).text();
                                  jQuery(this).html(text);
                              });
                            }

                            var item_template =
                            '<tr class="item">' +
                              '<td class="case_id" id="case-id-<%= obj.id %>"><div class="desc hidden"><%= obj.description %></div>' +
                              '<span class="unescape"><%= obj.case_number %></span></td>' +
                              '<td class="case_slug"><a href="<%= obj.slug %>">'+
                              '<h4 class="unescape"> <%= obj.title %></h4> </a></td>' +
                              '<td class="case_topics"><a href="/category/<%= obj.cat_url %>"> <span><%= obj.category %></span></a></td>' +
                            '</tr>';

                            settings = {
                              items            : Cases.cases,
                              facets           : {
                                                  'category': 'Category',
                                                  'topics': 'Filter by Topic',
                                                  'related_cases': 'Related Cases'
                                                 },
                              resultSelector   : '#results',
                              facetSelector    : '#facets',
                              resultTemplate   : item_template,
                              paginationCount  : 1000,
                              orderByOptions   : {'case_number': 'Case Number', 'title': 'Title'},
                              bottomContainer    : '<div class="bottom-container"></div>',
                              showMoreTemplate   : '<a id=showmorebutton>Show More</a>',
                              //facetSortOption  : {'continent': ["North America", "South America"]}
                            }
                            console.log("settings.resultSelector");
                            console.log(settings.resultSelector);


                            //settings['state']['filters'][]

                            $(settings.resultSelector).bind("facetuicreated", function(){
                              console.log("UI created");
         
       

                        
                               try {

                                var qry_params = window.location.href.split('?');
                                var params = qry_params[1];
                                var active_facets = params.split('&');

                                // go over url parameters and re create search results
                                for(var count_params=1; count_params < active_facets.length; count_params++)
                                {
                                    var find_facet = active_facets[count_params].split('=');
                                    var facet = find_facet[0]; //category/related topics/
                                    console.log(facet);
                                    //jQuery.facetUpdate(settings.state.filters['category'].push("Public Policy Cases"));
                                    // test_output = jQuery(settings.state.filters);
                                    //console.log(test_output);
                                    //console.log(settings.state.filters);
                                    //console.log(settings.state);
                                    //settings.facetSortOption  : {'facetname': facetname, 'filtername': filtername};
                                    var search_term = find_facet[1].split('_'); // filter term/sub categoryjQuery.facetelize(settings);"Public Policy Cases"
                                    var item_id = parseInt(search_term[1]);
                                    console.log(search_term);
                                    //settings.state.filters[facet].push(search_term);
                                    //settings.state.filters['category'].push("Public Policy Cases");
                                    /*settings.state.filters[key] = settings.state.filters[key] || [] ;jQuery.facetelize(settings);

                                    if (_.indexOf(settings.state.filters[key], value) == -1) {"Public Health and Medical Cases"
                                        settings.state.filters[key].push(value);
                                    } else {
                                        settings.state.filters[key] = _.without(settings.state.filters[key], value);
                                    }*/
                                }
                            
                                
                            }
                            catch(error){
                              console.log(error);
                            }
                             });


                            $('.active-facets').html(
                                '<span class="category" style="display:none">Category: </span>' +
                                '<span class="topics" style="display:none">Topics: </span>' +
                                '<span class="related_cases" style="display:none">Related Cases: </span>');
                        
                            // use them!
                            jQuery.facetelize(settings);
                            //console.log(test_var);
                            setTableHeaders();
                            unescapeHtml();
                            jQuery("#results").tablesorter(); 

                            jQuery('.orderbyitem')
                              .add(jQuery('.facetitem'))
                              .add(jQuery('.deselectstartover'))
                              .add(jQuery('#showmorebutton'))
                              .on('click', function(){
                                setTableHeaders();
                                unescapeHtml();
                              })
                              //jQuery.facetUpdate();


                            


                  })

              });
            </script>
            
    </body>

</html>
